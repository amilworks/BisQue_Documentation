<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="4.2 Planteome Deep Segment | Getting Started" />
<meta property="og:type" content="book" />

<meta property="og:image" content="images/cover.png" />
<meta property="og:description" content="BisQue (Bio-Image Semantic Query User Environment) : Store, visualize,organize and analyze images in the cloud." />




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>

<meta name="description" content="BisQue (Bio-Image Semantic Query User Environment) : Store, visualize,organize and analyze images in the cloud.">

<title>4.2 Planteome Deep Segment | Getting Started</title>

<script src="libs/header-attrs-2.1/header-attrs.js"></script>
<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link rel="stylesheet" href="style.css" type="text/css" />

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#cloud-service-module-development-python-api">Cloud Service | Module Development | Python API</a>
<ul>
<li><a href="docker-installation.html#docker-installation"><strong>Docker Installation</strong></a>
<ul>
<li><a href="docker-installation.html#docker">Docker</a></li>
</ul></li>
</ul></li>
<li><a href="1-intro.html#intro"><span class="toc-section-number">1</span> BisQue Cloud Service</a>
<ul>
<li><a href="1-1-how-to-login-or-create-a-new-user.html#how-to-login-or-create-a-new-user"><span class="toc-section-number">1.1</span> How to Login or Create a New User</a></li>
<li><a href="1-2-how-to-upload-data.html#how-to-upload-data"><span class="toc-section-number">1.2</span> How to Upload Data</a>
<ul>
<li><a href="1-2-how-to-upload-data.html#step-1.-login">Step 1. Login</a></li>
<li><a href="1-2-how-to-upload-data.html#step-2.-upload-file-or-folder">Step 2. Upload File or Folder</a></li>
<li><a href="1-2-how-to-upload-data.html#step-3.-build-a-dataset">Step 3. Build a Dataset</a></li>
<li><a href="1-2-how-to-upload-data.html#step-4.-setting-permissions">Step 4. Setting Permissions</a></li>
</ul></li>
<li><a href="1-3-how-to-add-annotations.html#how-to-add-annotations"><span class="toc-section-number">1.3</span> How to Add Annotations</a>
<ul>
<li><a href="1-3-how-to-add-annotations.html#overview">Overview</a></li>
</ul></li>
<li><a href="1-4-how-to-run-a-module.html#how-to-run-a-module"><span class="toc-section-number">1.4</span> How to Run a Module</a></li>
<li><a href="1-5-imagej-module.html#imagej-module"><span class="toc-section-number">1.5</span> ImageJ Module</a>
<ul>
<li><a href="1-5-imagej-module.html#overview-1">Overview</a></li>
<li><a href="1-5-imagej-module.html#uploading-of-imagej-pipelines">Uploading of ImageJ Pipelines</a></li>
<li><a href="1-5-imagej-module.html#running-an-imagej-macro">Running an ImageJ Macro</a></li>
<li><a href="1-5-imagej-module.html#special-bisque-extensions-for-imagej">Special BisQue extensions for ImageJ</a></li>
</ul></li>
<li><a href="1-6-cellprofiler-module.html#cellprofiler-module"><span class="toc-section-number">1.6</span> CellProfiler Module</a>
<ul>
<li><a href="1-6-cellprofiler-module.html#overview-2">Overview</a></li>
<li><a href="1-6-cellprofiler-module.html#uploading-of-cellprofiler-pipelines">Uploading of CellProfiler Pipelines</a></li>
<li><a href="1-6-cellprofiler-module.html#running-a-cellprofiler-pipeline">Running a CellProfiler Pipeline</a></li>
<li><a href="1-6-cellprofiler-module.html#results">Results</a></li>
</ul></li>
<li><a href="1-7-plant-cell-segmentation.html#plant-cell-segmentation"><span class="toc-section-number">1.7</span> Plant Cell Segmentation</a>
<ul>
<li><a href="1-7-plant-cell-segmentation.html#overview-3">Overview</a></li>
<li><a href="1-7-plant-cell-segmentation.html#input">Input</a></li>
<li><a href="1-7-plant-cell-segmentation.html#hyperparameters">Hyperparameters</a></li>
<li><a href="1-7-plant-cell-segmentation.html#cell-features">Cell Features</a></li>
<li><a href="1-7-plant-cell-segmentation.html#output">Output</a></li>
</ul></li>
</ul></li>
<li><a href="2-module-development.html#module-development"><span class="toc-section-number">2</span> Module Development</a>
<ul>
<li><a href="2-module-development.html#how-to-begin-building-modules"><strong>How to Begin Building Modules</strong></a></li>
<li><a href="2-1-dockerfile.html#dockerfile"><span class="toc-section-number">2.1</span> Dockerfile</a>
<ul>
<li><a href="2-1-dockerfile.html#example-composite-strength"><strong>Example: Composite Strength</strong></a></li>
</ul></li>
<li><a href="2-2-module-xml.html#module-xml"><span class="toc-section-number">2.2</span> Module XML</a>
<ul>
<li><a href="2-2-module-xml.html#example"><strong>Example</strong></a></li>
<li><a href="2-2-module-xml.html#module-description">Module Description</a></li>
<li><a href="2-2-module-xml.html#configurations-for-images-datasets-and-resources">Configurations for Images, Datasets, and Resources</a></li>
<li><a href="2-2-module-xml.html#data-parallel-execution">Data-Parallel Execution</a></li>
</ul></li>
<li><a href="2-3-python-script-wrapper.html#python-script-wrapper"><span class="toc-section-number">2.3</span> Python Script Wrapper</a>
<ul>
<li><a href="2-3-python-script-wrapper.html#example.-python-script-wrapper"><em>Example.</em> Python Script Wrapper</a></li>
</ul></li>
<li><a href="2-4-source-code.html#source-code"><span class="toc-section-number">2.4</span> Source Code</a>
<ul>
<li><a href="2-4-source-code.html#example.-composite-strength-module"><em>Example.</em> Composite Strength Module</a></li>
</ul></li>
<li><a href="2-5-runtime-module-configuration.html#runtime-module-configuration"><span class="toc-section-number">2.5</span> Runtime Module Configuration</a>
<ul>
<li><a href="2-5-runtime-module-configuration.html#example.-composite-strength-module-1"><em>Example.</em> Composite Strength Module</a></li>
</ul></li>
<li><a href="2-6-python-setup.html#python-setup"><span class="toc-section-number">2.6</span> Python Setup</a></li>
</ul></li>
<li><a href="3-bqapi.html#bqapi"><span class="toc-section-number">3</span> BQAPI</a>
<ul>
<li><a href="download-an-array.html#download-an-array"><strong>Download an Array</strong></a>
<ul>
<li><a href="download-an-array.html#access-an-hdf5-table-from-bisque">Access an HDF5 Table from BisQue</a></li>
</ul></li>
</ul></li>
<li><a href="4-bisque-development.html#bisque-development"><span class="toc-section-number">4</span> BisQue Development</a>
<ul>
<li><a href="4-1-source-code-installation.html#source-code-installation"><span class="toc-section-number">4.1</span> Source Code Installation</a>
<ul>
<li><a href="4-1-source-code-installation.html#clone-the-repository-and-prepare-virtual-environment">Clone the repository and Prepare Virtual Environment</a></li>
<li><a href="4-1-source-code-installation.html#configure-bisque-environment">Configure Bisque Environment</a></li>
<li><a href="4-1-source-code-installation.html#run-bisque-server">Run Bisque Server</a></li>
<li><a href="4-1-source-code-installation.html#upload-dataset">Upload Dataset</a></li>
<li><a href="4-1-source-code-installation.html#module">Module</a></li>
<li><a href="4-1-source-code-installation.html#debug-module">Debug Module</a></li>
<li><a href="4-1-source-code-installation.html#g.-module-mexui">G. Module MEX/UI</a></li>
</ul></li>
<li><a href="4-2-planteome-deep-segment.html#planteome-deep-segment"><span class="toc-section-number">4.2</span> Planteome Deep Segment</a></li>
<li><a href="4-3-rancher-2-0-setup-wkubernetes-engine.html#rancher-2.0-setup-wkubernetes-engine"><span class="toc-section-number">4.3</span> Rancher 2.0 Setup (w/Kubernetes engine)</a>
<ul>
<li><a href="4-3-rancher-2-0-setup-wkubernetes-engine.html#pre-requisite"><span class="toc-section-number">4.3.1</span> Pre-requisite</a></li>
<li><a href="4-3-rancher-2-0-setup-wkubernetes-engine.html#setup-workload-on-the-bq-cluster"><span class="toc-section-number">4.3.2</span> Setup Workload on the bq-cluster</a></li>
</ul></li>
<li><a href="4-4-connoisseurgpu-workload-provisioning.html#connoisseurgpu-workload-provisioning"><span class="toc-section-number">4.4</span> Connoisseur/GPU Workload provisioning</a></li>
<li><a href="4-5-rancher-condor.html#rancher-condor"><span class="toc-section-number">4.5</span> Rancher Condor</a>
<ul>
<li><a href="4-5-rancher-condor.html#topology"><span class="toc-section-number">4.5.1</span> Topology</a></li>
<li><a href="4-5-rancher-condor.html#masterworker-condor-config"><span class="toc-section-number">4.5.2</span> Master/Worker Condor Config</a></li>
<li><a href="4-5-rancher-condor.html#bisquesvc-submit-node-condor-config"><span class="toc-section-number">4.5.3</span> BisqueSvc Submit Node Condor Config</a></li>
<li><a href="4-5-rancher-condor.html#state-logs"><span class="toc-section-number">4.5.4</span> State &amp; logs</a></li>
<li><a href="4-5-rancher-condor.html#test-condor"><span class="toc-section-number">4.5.5</span> Test Condor</a></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="planteome-deep-segment" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Planteome Deep Segment</h2>
<p><strong>This module segments a marked object (creating a graphical object) within an input image.</strong></p>
<p>Then the module will classify either the entire original image or the segment created in the first step. This uses PyTorch in order to do this deep segmentation.</p>
<div id="reference" class="section level4" number="4.2.0.1">
<h4><span class="header-section-number">4.2.0.1</span> <a href="https://github.com/pndaly/BisQue_Platform_Guide">Reference</a></h4>
<ul>
<li>Module Development Guide: <a href="https://github.com/pndaly/BisQue_Platform_Guide" class="uri">https://github.com/pndaly/BisQue_Platform_Guide</a></li>
<li>Sample Deep Learning Module: <a href="https://github.com/Planteome/planteome-deep-segmenter-dockerized">Planteome Deep Segment Analysis</a></li>
</ul>
</div>
<div id="prerequisites-1" class="section level4" number="4.2.0.2">
<h4><span class="header-section-number">4.2.0.2</span> Prerequisites</h4>
<ul>
<li>Working bisque environment at <a href="http://loup.ece.ucsb.edu:8088/" class="uri">http://loup.ece.ucsb.edu:8088/</a></li>
<li>Docker should be enabled and setup on this environment</li>
<li>The bisque deployment server should have access to good CPU &amp; RAM since Torch &amp; Scikit-image is used</li>
<li>Access to module folder for deploying this module (Say at ~/bisque/module)</li>
</ul>
</div>
<div id="adddeploy-the-planteome-module" class="section level4" number="4.2.0.3">
<h4><span class="header-section-number">4.2.0.3</span> Add/Deploy the <a href="https://github.com/Planteome/planteome-deep-segmenter-dockerized">Planteome module</a></h4>
<ul>
<li>Identify the bisque module folder at path ~/bisque/module</li>
<li>Login to <a href="http://loup.ece.ucsb.edu:8088/" class="uri">http://loup.ece.ucsb.edu:8088/</a> with credentials admin:admin</li>
<li>Download the <a href="https://github.com/Planteome/planteome-deep-segmenter-dockerized">Planteome module</a> to the bisque module folder</li>
<li>Register the module to Bisque by opening the Module Manager
<img src="img/module_planteome/module_menu.png" alt="Module Manager Menu" /></li>
<li>Provide the engine URL(<a href="http://loup.ece.ucsb.edu:8088/engine_service" class="uri">http://loup.ece.ucsb.edu:8088/engine_service</a>) in the Engine service section and click load. This will list the modules by querying the engine service.</li>
<li>Select the module named “Planteome”, drag this module to the left pane and drop it to register.
<img src="img/module_planteome/module_add_planteome.png" alt="Module Register" /></li>
</ul>
</div>
<div id="buildconfigure-the-module" class="section level4" number="4.2.0.4">
<h4><span class="header-section-number">4.2.0.4</span> Build/Configure the module</h4>
<ul>
<li>Edit the runtime-module.cfg with relevant configuration
<ul>
<li>Changed the docker.hub configuration to biodev.ece.ucsb.edu:5000</li>
</ul></li>
<li>View/Edit the Dockerfile for the relevant packages
<ul>
<li>Edited versions for numpy==1.16.1 &amp; scikit-image==0.14.2</li>
</ul></li>
<li>Source to your bisque python environment “workon bqenv” for installation
<ul>
<li>pip install -r requirements.txt</li>
<li>python setup.py</li>
</ul></li>
</ul>
<p>This will install all the dependency in the modules requirements.txt file, build modules code, and create a docker image for running it. Based on your “docker.hub” configuration the setup will push the docker image to registry as [biodev.ece.ucsb.edu:5000/bisque_uplanteome]</p>
</div>
<div id="steps-to-run-the-algorithm-from-bisque-client" class="section level4" number="4.2.0.5">
<h4><span class="header-section-number">4.2.0.5</span> Steps to run the algorithm from Bisque Client</h4>
<ul>
<li><p>Select an image to be analyzed.</p></li>
<li><p>The foreground/background annotation tooltip can be found on the top-right of the module image viewer. Mark the part of the image to be segmented with foreground line(s) annotation(s). Mark the image with background annotations around the object to be segmented.
<img src="img/module_planteome/setup_planteome.png" alt="Test Segmentation Setup" /></p></li>
<li><p>Select which deep classifier to use, whether to segment the image, the segmentation quality, and whether to classify the entire image or the segmented object instead.</p></li>
<li><p>Press the ‘RUN’ button. Analysis may take some time depending on the image and segmentation quality.</p></li>
<li><p>Results are given in visual and table formats, depending on whether the segmentation and classification functionalities respectively were enabled in the options.
<img src="img/module_planteome/results_planteome.png" alt="Test Segmentation Results" /></p></li>
</ul>
</div>
<div id="isolateddevelopment-test-setup" class="section level4" number="4.2.0.6">
<h4><span class="header-section-number">4.2.0.6</span> Isolated/Development test setup</h4>
<p>Make sure you have annotated the image and have an a mex identifier availablefor manual test/run.
This can be done by,
- Opening the module and select image
- Annotate the image as per the directions above
- Configure and run the module once
- Make note of the mex URL for this run by looking at the docker_run.log in the staging folder. This will be used for replaying the test run from the modules folder.</p>
<p>Additional module execution information
- When we annotate the image and click RUN on the module user interface
- The Planteome module is created from biodev.ece.ucsb.edu:5000/bisque_uplanteome:latest</p>
<pre><code>```
docker create biodev.ece.ucsb.edu:5000/bisque_uplanteome \
python PlanteomeDeepSegment.py \
http://loup.ece.ucsb.edu:8088/module_service/mex/00-NKpU4CWiHfupgckuXBNFDd \
admin:00-NKpU4CWiHfupgckuXBNFDd Simple True 3 False
```</code></pre>
<ul>
<li>This module is run with the hash id of the docker create</li>
</ul>
<div id="setuprun-the-docker-container-for-test" class="section level5" number="4.2.0.6.1">
<h5><span class="header-section-number">4.2.0.6.1</span> Setup/Run the docker container for test</h5>
<ul>
<li>Build the docker container
<ul>
<li>docker build –no-cache -t bisque_uplanteome -f Dockerfile .</li>
<li>docker build -t biodev.ece.ucsb.edu:5000/bisque_uplanteome .</li>
</ul></li>
<li>Run the container and bash into it
<ul>
<li>docker run -it –net=host biodev.ece.ucsb.edu:5000/bisque_uplanteome bash</li>
</ul></li>
<li>test run the code on mex identifier
<ul>
<li>python PlanteomeDeepSegment.py <a href="http://loup.ece.ucsb.edu:8088/module_service/mex/00-NKpU4CWiHfupgckuXBNFDd" class="uri">http://loup.ece.ucsb.edu:8088/module_service/mex/00-NKpU4CWiHfupgckuXBNFDd</a> admin:00-NKpU4CWiHfupgckuXBNFDd Simple True 3 False</li>
</ul></li>
</ul>
<p>Version: 0.3
Author(s): Dimitrios Trigkakis, Justin Preece</p>
</div>
</div>
</div>
<p style="text-align: center;">
<a href="4-1-source-code-installation.html"><button class="btn btn-default">Previous</button></a>
<a href="4-3-rancher-2-0-setup-wkubernetes-engine.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>

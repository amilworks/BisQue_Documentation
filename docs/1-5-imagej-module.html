<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="1.5 ImageJ Module | Getting Started" />
<meta property="og:type" content="book" />

<meta property="og:image" content="images/cover.png" />
<meta property="og:description" content="BisQue (Bio-Image Semantic Query User Environment) : Store, visualize,organize and analyze images in the cloud." />




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>

<meta name="description" content="BisQue (Bio-Image Semantic Query User Environment) : Store, visualize,organize and analyze images in the cloud.">

<title>1.5 ImageJ Module | Getting Started</title>

<script src="libs/header-attrs-2.1/header-attrs.js"></script>
<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link rel="stylesheet" href="style.css" type="text/css" />

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#cloud-service-module-development-python-api">Cloud Service | Module Development | Python API</a>
<ul>
<li><a href="docker-installation.html#docker-installation"><strong>Docker Installation</strong></a>
<ul>
<li><a href="docker-installation.html#docker">Docker</a></li>
</ul></li>
</ul></li>
<li><a href="1-intro.html#intro"><span class="toc-section-number">1</span> BisQue Cloud Service</a>
<ul>
<li><a href="1-1-how-to-login-or-create-a-new-user.html#how-to-login-or-create-a-new-user"><span class="toc-section-number">1.1</span> How to Login or Create a New User</a></li>
<li><a href="1-2-how-to-upload-data.html#how-to-upload-data"><span class="toc-section-number">1.2</span> How to Upload Data</a>
<ul>
<li><a href="1-2-how-to-upload-data.html#step-1.-login">Step 1. Login</a></li>
<li><a href="1-2-how-to-upload-data.html#step-2.-upload-file-or-folder">Step 2. Upload File or Folder</a></li>
<li><a href="1-2-how-to-upload-data.html#step-3.-build-a-dataset">Step 3. Build a Dataset</a></li>
<li><a href="1-2-how-to-upload-data.html#step-4.-setting-permissions">Step 4. Setting Permissions</a></li>
</ul></li>
<li><a href="1-3-how-to-add-annotations.html#how-to-add-annotations"><span class="toc-section-number">1.3</span> How to Add Annotations</a>
<ul>
<li><a href="1-3-how-to-add-annotations.html#overview">Overview</a></li>
</ul></li>
<li><a href="1-4-how-to-run-a-module.html#how-to-run-a-module"><span class="toc-section-number">1.4</span> How to Run a Module</a></li>
<li><a href="1-5-imagej-module.html#imagej-module"><span class="toc-section-number">1.5</span> ImageJ Module</a>
<ul>
<li><a href="1-5-imagej-module.html#overview-1">Overview</a></li>
<li><a href="1-5-imagej-module.html#uploading-of-imagej-pipelines">Uploading of ImageJ Pipelines</a></li>
<li><a href="1-5-imagej-module.html#running-an-imagej-macro">Running an ImageJ Macro</a></li>
<li><a href="1-5-imagej-module.html#special-bisque-extensions-for-imagej">Special BisQue extensions for ImageJ</a></li>
</ul></li>
<li><a href="1-6-cellprofiler-module.html#cellprofiler-module"><span class="toc-section-number">1.6</span> CellProfiler Module</a>
<ul>
<li><a href="1-6-cellprofiler-module.html#overview-2">Overview</a></li>
<li><a href="1-6-cellprofiler-module.html#uploading-of-cellprofiler-pipelines">Uploading of CellProfiler Pipelines</a></li>
<li><a href="1-6-cellprofiler-module.html#running-a-cellprofiler-pipeline">Running a CellProfiler Pipeline</a></li>
<li><a href="1-6-cellprofiler-module.html#results">Results</a></li>
</ul></li>
<li><a href="1-7-plant-cell-segmentation.html#plant-cell-segmentation"><span class="toc-section-number">1.7</span> Plant Cell Segmentation</a>
<ul>
<li><a href="1-7-plant-cell-segmentation.html#overview-3">Overview</a></li>
<li><a href="1-7-plant-cell-segmentation.html#input">Input</a></li>
<li><a href="1-7-plant-cell-segmentation.html#hyperparameters">Hyperparameters</a></li>
<li><a href="1-7-plant-cell-segmentation.html#cell-features">Cell Features</a></li>
<li><a href="1-7-plant-cell-segmentation.html#output">Output</a></li>
</ul></li>
</ul></li>
<li><a href="2-module-development.html#module-development"><span class="toc-section-number">2</span> Module Development</a>
<ul>
<li><a href="2-module-development.html#how-to-begin-building-modules"><strong>How to Begin Building Modules</strong></a></li>
<li><a href="2-1-dockerfile.html#dockerfile"><span class="toc-section-number">2.1</span> Dockerfile</a>
<ul>
<li><a href="2-1-dockerfile.html#example-composite-strength"><strong>Example: Composite Strength</strong></a></li>
</ul></li>
<li><a href="2-2-module-xml.html#module-xml"><span class="toc-section-number">2.2</span> Module XML</a>
<ul>
<li><a href="2-2-module-xml.html#example"><strong>Example</strong></a></li>
<li><a href="2-2-module-xml.html#module-description">Module Description</a></li>
<li><a href="2-2-module-xml.html#configurations-for-images-datasets-and-resources">Configurations for Images, Datasets, and Resources</a></li>
<li><a href="2-2-module-xml.html#data-parallel-execution">Data-Parallel Execution</a></li>
</ul></li>
<li><a href="2-3-python-script-wrapper.html#python-script-wrapper"><span class="toc-section-number">2.3</span> Python Script Wrapper</a>
<ul>
<li><a href="2-3-python-script-wrapper.html#example.-python-script-wrapper"><em>Example.</em> Python Script Wrapper</a></li>
</ul></li>
<li><a href="2-4-source-code.html#source-code"><span class="toc-section-number">2.4</span> Source Code</a>
<ul>
<li><a href="2-4-source-code.html#example.-composite-strength-module"><em>Example.</em> Composite Strength Module</a></li>
</ul></li>
<li><a href="2-5-runtime-module-configuration.html#runtime-module-configuration"><span class="toc-section-number">2.5</span> Runtime Module Configuration</a>
<ul>
<li><a href="2-5-runtime-module-configuration.html#example.-composite-strength-module-1"><em>Example.</em> Composite Strength Module</a></li>
</ul></li>
<li><a href="2-6-python-setup.html#python-setup"><span class="toc-section-number">2.6</span> Python Setup</a></li>
</ul></li>
<li><a href="3-bqapi.html#bqapi"><span class="toc-section-number">3</span> BQAPI</a>
<ul>
<li><a href="download-an-array.html#download-an-array"><strong>Download an Array</strong></a>
<ul>
<li><a href="download-an-array.html#access-an-hdf5-table-from-bisque">Access an HDF5 Table from BisQue</a></li>
</ul></li>
</ul></li>
<li><a href="4-bisque-development.html#bisque-development"><span class="toc-section-number">4</span> BisQue Development</a>
<ul>
<li><a href="4-1-source-code-installation.html#source-code-installation"><span class="toc-section-number">4.1</span> Source Code Installation</a>
<ul>
<li><a href="4-1-source-code-installation.html#clone-the-repository-and-prepare-virtual-environment">Clone the repository and Prepare Virtual Environment</a></li>
<li><a href="4-1-source-code-installation.html#configure-bisque-environment">Configure Bisque Environment</a></li>
<li><a href="4-1-source-code-installation.html#run-bisque-server">Run Bisque Server</a></li>
<li><a href="4-1-source-code-installation.html#upload-dataset">Upload Dataset</a></li>
<li><a href="4-1-source-code-installation.html#module">Module</a></li>
<li><a href="4-1-source-code-installation.html#debug-module">Debug Module</a></li>
<li><a href="4-1-source-code-installation.html#g.-module-mexui">G. Module MEX/UI</a></li>
</ul></li>
<li><a href="4-2-planteome-deep-segment.html#planteome-deep-segment"><span class="toc-section-number">4.2</span> Planteome Deep Segment</a></li>
<li><a href="4-3-rancher-2-0-setup-wkubernetes-engine.html#rancher-2.0-setup-wkubernetes-engine"><span class="toc-section-number">4.3</span> Rancher 2.0 Setup (w/Kubernetes engine)</a>
<ul>
<li><a href="4-3-rancher-2-0-setup-wkubernetes-engine.html#pre-requisite"><span class="toc-section-number">4.3.1</span> Pre-requisite</a></li>
<li><a href="4-3-rancher-2-0-setup-wkubernetes-engine.html#setup-workload-on-the-bq-cluster"><span class="toc-section-number">4.3.2</span> Setup Workload on the bq-cluster</a></li>
</ul></li>
<li><a href="4-4-connoisseurgpu-workload-provisioning.html#connoisseurgpu-workload-provisioning"><span class="toc-section-number">4.4</span> Connoisseur/GPU Workload provisioning</a></li>
<li><a href="4-5-rancher-condor.html#rancher-condor"><span class="toc-section-number">4.5</span> Rancher Condor</a>
<ul>
<li><a href="4-5-rancher-condor.html#topology"><span class="toc-section-number">4.5.1</span> Topology</a></li>
<li><a href="4-5-rancher-condor.html#masterworker-condor-config"><span class="toc-section-number">4.5.2</span> Master/Worker Condor Config</a></li>
<li><a href="4-5-rancher-condor.html#bisquesvc-submit-node-condor-config"><span class="toc-section-number">4.5.3</span> BisqueSvc Submit Node Condor Config</a></li>
<li><a href="4-5-rancher-condor.html#state-logs"><span class="toc-section-number">4.5.4</span> State &amp; logs</a></li>
<li><a href="4-5-rancher-condor.html#test-condor"><span class="toc-section-number">4.5.5</span> Test Condor</a></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="imagej-module" class="section level2" number="1.5">
<h2><span class="header-section-number">1.5</span> ImageJ Module</h2>
<div id="overview-1" class="section level3 unnumbered" number="">
<h3>Overview</h3>
<p>The ImageJ module allows users to execute arbitrary ImageJ macros on single images or datasets of images. Macro parameters can be changed and parameter value lists can be provided to experiment with parameter variations. The results are stored back in BisQue as Gobjects, tables, or images.</p>
<hr />
</div>
<div id="uploading-of-imagej-pipelines" class="section level3 unnumbered" number="">
<h3>Uploading of ImageJ Pipelines</h3>
<p>Most ImageJ macros can be uploaded and used directly with minor modifications. In order to upload a macro, click “Upload”, select the macro file, and click “Upload”. If the file extension is “.ijm”, the file will automatically be recognized as a CellProfiler macro.</p>
<p>As an example, we upload the CometAssay macro developed at the Microscopy Services Laboratory of the University of North Carolina at Chapel Hill, <a href="https://www.med.unc.edu/microscopy/resources/imagej-plugins-and-macros/comet-assay">Comet Assay</a>.</p>
<p>In order to verify the macro, it can be opened by browsing the <code>imagej_pipeline</code> resources and opening the recently uploaded macro.</p>
<p>It will look like this:</p>
<div class="figure">
<img src="images/orig_pipeline.png" alt="" />
<p class="caption">ImageJ Pipeline</p>
</div>
<p>Each box represents one ImageJ macro step and the arrows indicate the flow through the steps. Note that some boxes have different colors. For example, the “waitForUser” and “Dialog”-related boxes are shown in red to indicate that they are incompatible with BisQue and will render the macro non-executable. Green boxes indicate regular ImageJ steps that were kept unchanged. Blue boxes are BisQue specific steps (such as “load image from BisQue” or “store table to BisQue”).</p>
<p>In order to execute the pipeline, we need to fix the red boxes and then re-upload the pipeline. In this example, the first red boxes correspond to the <code>waitForUser</code> steps of the macro:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="1-5-imagej-module.html#cb6-1"></a><span class="ex">waitForUser</span>(<span class="st">&quot;Draw an oval around the comet head; Click OK&quot;</span>);</span>
<span id="cb6-2"><a href="1-5-imagej-module.html#cb6-2"></a><span class="ex">run</span>(<span class="st">&quot;Measure&quot;</span>);</span>
<span id="cb6-3"><a href="1-5-imagej-module.html#cb6-3"></a><span class="ex">waitForUser</span>(<span class="st">&quot;Draw an oval around the comet tail; Click OK&quot;</span>);</span>
<span id="cb6-4"><a href="1-5-imagej-module.html#cb6-4"></a><span class="ex">run</span>(<span class="st">&quot;Measure&quot;</span>);</span></code></pre></div>
<p>Since BisQue modules are currently not interactive, such steps are not allowed. However, since they request user-defined regions for head and tail of the comet to analyze, we can replace them with <code>BisQueLoadPolygon</code> steps:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb7-1"><a href="1-5-imagej-module.html#cb7-1"></a><span class="ex">BisQueLoadPolygon</span>(<span class="st">&quot;head&quot;</span>);</span>
<span id="cb7-2"><a href="1-5-imagej-module.html#cb7-2"></a><span class="ex">run</span>(<span class="st">&quot;Measure&quot;</span>);</span>
<span id="cb7-3"><a href="1-5-imagej-module.html#cb7-3"></a><span class="ex">BisQueLoadPolygon</span>(<span class="st">&quot;tail&quot;</span>);</span>
<span id="cb7-4"><a href="1-5-imagej-module.html#cb7-4"></a><span class="ex">run</span>(<span class="st">&quot;Measure&quot;</span>);</span></code></pre></div>
<p>Each <code>BisQueLoadPolygon</code> step searches for a polygon Gobject in the current image and returns it as an ImageJ selection.</p>
<p>The other red boxes correspond to ImageJ “Dialog” functions:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb8-1"><a href="1-5-imagej-module.html#cb8-1"></a><span class="ex">Dialog.create</span>(<span class="st">&quot;Do Another?&quot;</span>);</span>
<span id="cb8-2"><a href="1-5-imagej-module.html#cb8-2"></a><span class="ex">Dialog.addCheckbox</span>(<span class="st">&quot;Yes&quot;</span>, true);</span>
<span id="cb8-3"><a href="1-5-imagej-module.html#cb8-3"></a><span class="ex">Dialog.show</span>();</span></code></pre></div>
<p>Again, since BisQue is not interactive, these are not allowed. In this example, these steps check if the user wants to analyze more comets. For simplicity, we will simply remove these steps and end the analysis after one iteration.</p>
<p>This addresses all red boxes but before being able to run the macro in BisQue, we need to add two important steps: the input and output. For the input, we can just add a new step at the very beginning:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb9-1"><a href="1-5-imagej-module.html#cb9-1"></a><span class="fu">BisQueLoadImage()</span>;</span></code></pre></div>
<p>This will load the current image of the module execution into ImageJ for analysis. Note that for larger datasets of images, the macro will be executed once for each image.</p>
<p>For the output, we will store the comet analysis results as a table back into BisQue. This is achieved by adding the following line at the end of the macro:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb10-1"><a href="1-5-imagej-module.html#cb10-1"></a><span class="ex">BisQueSaveResults</span>(<span class="st">&quot;comet stats&quot;</span>);</span></code></pre></div>
<p>This step will read the ImageJ results table and store it in BisQue under the given name. It will be linked in the output section of the current MEX (module execution) document.</p>
<p>The completed macro is now as follows:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb11-1"><a href="1-5-imagej-module.html#cb11-1"></a><span class="fu">BisQueLoadImage()</span>;</span>
<span id="cb11-2"><a href="1-5-imagej-module.html#cb11-2"></a><span class="ex">run</span>(<span class="st">&quot;Set Measurements...&quot;</span>, <span class="st">&quot;centroid center integrated redirect=None decimal=3&quot;</span>);</span>
<span id="cb11-3"><a href="1-5-imagej-module.html#cb11-3"></a><span class="ex">setFont</span>(<span class="st">&quot;SansSerif&quot;</span>, 18);</span>
<span id="cb11-4"><a href="1-5-imagej-module.html#cb11-4"></a><span class="ex">setColor</span>(255, 255, 255);</span>
<span id="cb11-5"><a href="1-5-imagej-module.html#cb11-5"></a><span class="ex">BisQueLoadPolygon</span>(<span class="st">&quot;head&quot;</span>);</span>
<span id="cb11-6"><a href="1-5-imagej-module.html#cb11-6"></a><span class="ex">run</span>(<span class="st">&quot;Measure&quot;</span>);</span>
<span id="cb11-7"><a href="1-5-imagej-module.html#cb11-7"></a><span class="ex">BisQueLoadPolygon</span>(<span class="st">&quot;tail&quot;</span>);</span>
<span id="cb11-8"><a href="1-5-imagej-module.html#cb11-8"></a><span class="ex">run</span>(<span class="st">&quot;Measure&quot;</span>);</span>
<span id="cb11-9"><a href="1-5-imagej-module.html#cb11-9"></a><span class="ex">i</span> = nResults -1<span class="kw">;</span></span>
<span id="cb11-10"><a href="1-5-imagej-module.html#cb11-10"></a><span class="ex">tailx</span> = getResult(<span class="st">&quot;XM&quot;</span>, i);</span>
<span id="cb11-11"><a href="1-5-imagej-module.html#cb11-11"></a><span class="ex">headx</span> = getResult(<span class="st">&quot;X&quot;</span>, i-1);</span>
<span id="cb11-12"><a href="1-5-imagej-module.html#cb11-12"></a><span class="ex">taily</span> = getResult(<span class="st">&quot;YM&quot;</span>, i);</span>
<span id="cb11-13"><a href="1-5-imagej-module.html#cb11-13"></a><span class="ex">heady</span> = getResult(<span class="st">&quot;Y&quot;</span>, i-1);</span>
<span id="cb11-14"><a href="1-5-imagej-module.html#cb11-14"></a><span class="ex">tailden</span> = getResult(<span class="st">&quot;RawIntDen&quot;</span>,i);</span>
<span id="cb11-15"><a href="1-5-imagej-module.html#cb11-15"></a><span class="ex">headden</span> = getResult(<span class="st">&quot;RawIntDen&quot;</span>,i-1);</span>
<span id="cb11-16"><a href="1-5-imagej-module.html#cb11-16"></a><span class="ex">CometLen</span> = sqrt( ((tailx-headx)<span class="ex">*</span> (tailx-headx)) <span class="ex">+</span> ((taily-heady)<span class="ex">*</span>(taily-heady)) );</span>
<span id="cb11-17"><a href="1-5-imagej-module.html#cb11-17"></a><span class="ex">setResult</span>(<span class="st">&quot;TailLen&quot;</span>,i,(CometLen));</span>
<span id="cb11-18"><a href="1-5-imagej-module.html#cb11-18"></a><span class="ex">setResult</span>(<span class="st">&quot;TailMoment&quot;</span>,i , (CometLen * tailden));</span>
<span id="cb11-19"><a href="1-5-imagej-module.html#cb11-19"></a><span class="ex">setResult</span>(<span class="st">&quot;%TailDNA&quot;</span>,i ,(tailden/(tailden + headden))<span class="ex">*100</span>);</span>
<span id="cb11-20"><a href="1-5-imagej-module.html#cb11-20"></a><span class="fu">updateResults()</span>;</span>
<span id="cb11-21"><a href="1-5-imagej-module.html#cb11-21"></a><span class="ex">BisQueSaveResults</span>(<span class="st">&quot;comet stats&quot;</span>);</span></code></pre></div>
<p>After uploading this macro again, all boxes are either green or blue, indicating the pipeline is now valid for execution.</p>
<hr />
</div>
<div id="running-an-imagej-macro" class="section level3 unnumbered" number="">
<h3>Running an ImageJ Macro</h3>
<p>ImageJ macros can be run like any other BisQue module. First, select the macro to run (in this example, we select the CometAssay macro. After viewing the pipeline, click on “Analyze” and then on “ImageJ”.
The ImageJ module page opens. Click “Select an Image” to choose a single image to run the macro on (alternatively, a dataset of images can be selected to run the macro on multiple images in parallel):</p>
<div class="figure">
<img src="images/imagej_module.2.png" alt="" />
<p class="caption">ImageJ Pipeline</p>
</div>
<p>Note that the selected image(s) need to have at least two polygon Gobjects: one with semantic type “head” and one with semantic type “tail”.</p>
<p>Finally, click the “Run” button to start the macro execution.</p>
<p>Once the execution finishes, the outputs are shown in section 4:</p>
<div class="figure">
<img src="images/imagej_results.png" alt="" />
<p class="caption">ImageJ Pipeline</p>
</div>
<p>In this case, one table “comet stats” was generated. It contains the comet statistics computed in the macro. Depending on the macro, images or Gobjects can also be generated as output (see next section).</p>
<p>The generated tables can now be processed further in additional BisQue modules or shared with other users.</p>
<hr />
</div>
<div id="special-bisque-extensions-for-imagej" class="section level3 unnumbered" number="">
<h3>Special BisQue extensions for ImageJ</h3>
<p>There are several BisQue-specific extensions to ImageJ to allow ImageJ macros to interact with the BisQue system. Each one is described in the following.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb12-1"><a href="1-5-imagej-module.html#cb12-1"></a><span class="fu">BisQueLoadImage()</span></span></code></pre></div>
<p>This function corresponds to the <code>open()</code> function of ImageJ. Instead of opening an image from a file, however, it obtains the image from the BisQue module executor. The opened image is one of the images from the module input section.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb13-1"><a href="1-5-imagej-module.html#cb13-1"></a><span class="ex">BisQueLoadPolygon</span>(<span class="st">&quot;gobject type&quot;</span>)</span></code></pre></div>
<p>This function loads a polygon Gobject from the current image into ImageJ as a selection for further processing in the macro. The “gobject type” parameter is used to select a specific Gobject with the semantic type “gobject type”.
In other words, the current image has to have a Gobject as follows:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb14-1"><a href="1-5-imagej-module.html#cb14-1"></a><span class="op">&lt;</span><span class="ex">gobject</span> type=<span class="st">&quot;gobject type&quot;</span><span class="op">&gt;</span></span>
<span id="cb14-2"><a href="1-5-imagej-module.html#cb14-2"></a>  <span class="op">&lt;</span><span class="ex">polygon</span><span class="op">&gt;</span></span>
<span id="cb14-3"><a href="1-5-imagej-module.html#cb14-3"></a>    <span class="op">&lt;</span><span class="ex">vertex</span> index=<span class="st">&quot;0&quot;</span> t=<span class="st">&quot;0.0&quot;</span> x=<span class="st">&quot;735.0&quot;</span> y=<span class="st">&quot;617.0&quot;</span> z=<span class="st">&quot;0.0&quot;</span>/<span class="op">&gt;</span></span>
<span id="cb14-4"><a href="1-5-imagej-module.html#cb14-4"></a>    <span class="ex">...</span></span>
<span id="cb14-5"><a href="1-5-imagej-module.html#cb14-5"></a>    <span class="op">&lt;</span><span class="ex">vertex</span> index=<span class="st">&quot;10&quot;</span> t=<span class="st">&quot;0.0&quot;</span> x=<span class="st">&quot;727.0&quot;</span> y=<span class="st">&quot;624.0&quot;</span> z=<span class="st">&quot;0.0&quot;</span>/<span class="op">&gt;</span></span>
<span id="cb14-6"><a href="1-5-imagej-module.html#cb14-6"></a>  <span class="op">&lt;</span>/<span class="ex">polygon</span><span class="op">&gt;</span></span>
<span id="cb14-7"><a href="1-5-imagej-module.html#cb14-7"></a><span class="op">&lt;</span>/<span class="ex">gobject</span><span class="op">&gt;</span></span></code></pre></div>
<p>This can be generated for example via the graphical annotations tool in the BisQue image viewer.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb15-1"><a href="1-5-imagej-module.html#cb15-1"></a><span class="ex">BisQueSaveImage</span>(<span class="st">&quot;image name&quot;</span>)</span></code></pre></div>
<p>This function corresponds to the <code>saveAs("Tiff", ...)</code> function of ImageJ. Instead of saving the image to a file, however, it stores the image back into BisQue as a new image resource. The created image is then referenced in the MEX (module execution) document’s output section.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb16-1"><a href="1-5-imagej-module.html#cb16-1"></a><span class="ex">BisQueSaveROIs</span>(<span class="st">&quot;polygon&quot;</span>, <span class="st">&quot;label&quot;</span>, <span class="st">&quot;color&quot;</span>)</span></code></pre></div>
<p>This function stores the current ImageJ ROIs as polygon Gobjects in the output section of the current MEX (module execution) document. Each polygon is assigned the provided label and color.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb17-1"><a href="1-5-imagej-module.html#cb17-1"></a><span class="ex">BisQueAddTag</span>(<span class="st">&quot;tag_name&quot;</span>, <span class="st">&quot;tag_value&quot;</span>)</span></code></pre></div>
<p>This function adds a tag/value pair to the output section of the current MEX (module execution) document.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb18-1"><a href="1-5-imagej-module.html#cb18-1"></a><span class="fu">BisQueSaveResults()</span></span></code></pre></div>
<p>This function stores the current ImageJ result table as a table resource in BisQue. The created table is then referenced in the MEX (module execution) document’s output section.</p>
</div>
</div>
<p style="text-align: center;">
<a href="1-4-how-to-run-a-module.html"><button class="btn btn-default">Previous</button></a>
<a href="1-6-cellprofiler-module.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>

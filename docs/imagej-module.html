<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1.4 ImageJ Module | BisQue_Documentation.utf8.md</title>
  <meta name="description" content="Bisque (Bio-Image Semantic Query User Environment) : Store, visualize, organize and analyze images in the cloud." />
  <meta name="generator" content="bookdown 0.13 and GitBook 2.6.7" />

  <meta property="og:title" content="1.4 ImageJ Module | BisQue_Documentation.utf8.md" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Bisque (Bio-Image Semantic Query User Environment) : Store, visualize, organize and analyze images in the cloud." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1.4 ImageJ Module | BisQue_Documentation.utf8.md" />
  
  <meta name="twitter:description" content="Bisque (Bio-Image Semantic Query User Environment) : Store, visualize, organize and analyze images in the cloud." />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="how-to-run-a-module.html"/>
<link rel="next" href="cellprofiler-module.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Official UCSB BisQue Documentation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Getting Started</a><ul>
<li class="chapter" data-level="" data-path="bisque-docker-installation.html"><a href="bisque-docker-installation.html"><i class="fa fa-check"></i>BisQue Docker Installation</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> BisQue Cloud Instance</a><ul>
<li class="chapter" data-level="1.1" data-path="how-to-login-or-create-a-new-user.html"><a href="how-to-login-or-create-a-new-user.html"><i class="fa fa-check"></i><b>1.1</b> How to Login or Create a New User</a></li>
<li class="chapter" data-level="1.2" data-path="how-to-upload-data.html"><a href="how-to-upload-data.html"><i class="fa fa-check"></i><b>1.2</b> How to Upload Data</a><ul>
<li class="chapter" data-level="" data-path="how-to-upload-data.html"><a href="how-to-upload-data.html#step-1.-login"><i class="fa fa-check"></i>Step 1. Login</a></li>
<li class="chapter" data-level="" data-path="how-to-upload-data.html"><a href="how-to-upload-data.html#step-2.-upload-file-or-folder"><i class="fa fa-check"></i>Step 2. Upload File or Folder</a></li>
<li class="chapter" data-level="" data-path="how-to-upload-data.html"><a href="how-to-upload-data.html#step-3.-build-a-dataset"><i class="fa fa-check"></i>Step 3. Build a Dataset</a></li>
<li class="chapter" data-level="" data-path="how-to-upload-data.html"><a href="how-to-upload-data.html#step-4.-setting-permissions"><i class="fa fa-check"></i>Step 4. Setting Permissions</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="how-to-run-a-module.html"><a href="how-to-run-a-module.html"><i class="fa fa-check"></i><b>1.3</b> How to Run a Module</a></li>
<li class="chapter" data-level="1.4" data-path="imagej-module.html"><a href="imagej-module.html"><i class="fa fa-check"></i><b>1.4</b> ImageJ Module</a><ul>
<li class="chapter" data-level="" data-path="imagej-module.html"><a href="imagej-module.html#overview"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="" data-path="imagej-module.html"><a href="imagej-module.html#uploading-of-imagej-pipelines"><i class="fa fa-check"></i>Uploading of ImageJ Pipelines</a></li>
<li class="chapter" data-level="" data-path="imagej-module.html"><a href="imagej-module.html#running-an-imagej-macro"><i class="fa fa-check"></i>Running an ImageJ Macro</a></li>
<li class="chapter" data-level="" data-path="imagej-module.html"><a href="imagej-module.html#special-bisque-extensions-for-imagej"><i class="fa fa-check"></i>Special BisQue extensions for ImageJ</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="cellprofiler-module.html"><a href="cellprofiler-module.html"><i class="fa fa-check"></i><b>1.5</b> CellProfiler Module</a><ul>
<li class="chapter" data-level="" data-path="cellprofiler-module.html"><a href="cellprofiler-module.html#overview-1"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="" data-path="cellprofiler-module.html"><a href="cellprofiler-module.html#uploading-of-cellprofiler-pipelines"><i class="fa fa-check"></i>Uploading of CellProfiler Pipelines</a></li>
<li class="chapter" data-level="" data-path="cellprofiler-module.html"><a href="cellprofiler-module.html#running-a-cellprofiler-pipeline"><i class="fa fa-check"></i>Running a CellProfiler Pipeline</a></li>
<li class="chapter" data-level="" data-path="cellprofiler-module.html"><a href="cellprofiler-module.html#results"><i class="fa fa-check"></i>Results</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="module-development.html"><a href="module-development.html"><i class="fa fa-check"></i><b>2</b> Module Development</a><ul>
<li class="chapter" data-level="2.1" data-path="dockerfile.html"><a href="dockerfile.html"><i class="fa fa-check"></i><b>2.1</b> Dockerfile</a></li>
<li class="chapter" data-level="2.2" data-path="module-xml.html"><a href="module-xml.html"><i class="fa fa-check"></i><b>2.2</b> Module XML</a><ul>
<li class="chapter" data-level="" data-path="module-xml.html"><a href="module-xml.html#module-description"><i class="fa fa-check"></i>Module Description</a></li>
<li class="chapter" data-level="" data-path="module-xml.html"><a href="module-xml.html#configurations-for-images-datasets-and-resources"><i class="fa fa-check"></i>Configurations for Images, Datasets, and Resources</a></li>
<li class="chapter" data-level="" data-path="module-xml.html"><a href="module-xml.html#data-parallel-execution"><i class="fa fa-check"></i>Data-Parallel Execution</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="python-script-wrapper.html"><a href="python-script-wrapper.html"><i class="fa fa-check"></i><b>2.3</b> Python Script Wrapper</a><ul>
<li><a href="python-script-wrapper.html#example.-python-script-wrapper"><em>Example.</em> Python Script Wrapper</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="source-code.html"><a href="source-code.html"><i class="fa fa-check"></i><b>2.4</b> Source Code</a><ul>
<li><a href="source-code.html#example.-composite-strength-module"><em>Example.</em> Composite Strength Module</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="runtime-module-configuration.html"><a href="runtime-module-configuration.html"><i class="fa fa-check"></i><b>2.5</b> Runtime Module Configuration</a></li>
<li class="chapter" data-level="2.6" data-path="python-setup.html"><a href="python-setup.html"><i class="fa fa-check"></i><b>2.6</b> Python Setup</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="bqapi.html"><a href="bqapi.html"><i class="fa fa-check"></i><b>3</b> BQAPI</a></li>
<li class="chapter" data-level="4" data-path="bisque-development.html"><a href="bisque-development.html"><i class="fa fa-check"></i><b>4</b> BisQue Development</a><ul>
<li class="chapter" data-level="4.1" data-path="source-code-installation.html"><a href="source-code-installation.html"><i class="fa fa-check"></i><b>4.1</b> Source Code Installation</a><ul>
<li class="chapter" data-level="" data-path="source-code-installation.html"><a href="source-code-installation.html#clone-the-repository-and-prepare-virtual-environment"><i class="fa fa-check"></i>Clone the repository and Prepare Virtual Environment</a></li>
<li class="chapter" data-level="" data-path="source-code-installation.html"><a href="source-code-installation.html#configure-bisque-environment"><i class="fa fa-check"></i>Configure Bisque Environment</a></li>
<li class="chapter" data-level="" data-path="source-code-installation.html"><a href="source-code-installation.html#run-bisque-server"><i class="fa fa-check"></i>Run Bisque Server</a></li>
<li class="chapter" data-level="" data-path="source-code-installation.html"><a href="source-code-installation.html#upload-dataset"><i class="fa fa-check"></i>Upload Dataset</a></li>
<li class="chapter" data-level="" data-path="source-code-installation.html"><a href="source-code-installation.html#module"><i class="fa fa-check"></i>Module</a></li>
<li class="chapter" data-level="" data-path="source-code-installation.html"><a href="source-code-installation.html#debug-module"><i class="fa fa-check"></i>Debug Module</a></li>
<li class="chapter" data-level="" data-path="source-code-installation.html"><a href="source-code-installation.html#g.-module-mexui"><i class="fa fa-check"></i>G. Module MEX/UI</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="planteome-deep-segment.html"><a href="planteome-deep-segment.html"><i class="fa fa-check"></i><b>4.2</b> Planteome Deep Segment</a></li>
<li class="chapter" data-level="4.3" data-path="rancher-2-0-setup-wkubernetes-engine.html"><a href="rancher-2-0-setup-wkubernetes-engine.html"><i class="fa fa-check"></i><b>4.3</b> Rancher 2.0 Setup (w/Kubernetes engine)</a><ul>
<li class="chapter" data-level="4.3.1" data-path="rancher-2-0-setup-wkubernetes-engine.html"><a href="rancher-2-0-setup-wkubernetes-engine.html#pre-requisite"><i class="fa fa-check"></i><b>4.3.1</b> Pre-requisite</a></li>
<li class="chapter" data-level="4.3.2" data-path="rancher-2-0-setup-wkubernetes-engine.html"><a href="rancher-2-0-setup-wkubernetes-engine.html#setup-workload-on-the-bq-cluster"><i class="fa fa-check"></i><b>4.3.2</b> Setup Workload on the bq-cluster</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="connoisseurgpu-workload-provisioning.html"><a href="connoisseurgpu-workload-provisioning.html"><i class="fa fa-check"></i><b>4.4</b> Connoisseur/GPU Workload provisioning</a></li>
<li class="chapter" data-level="4.5" data-path="rancher-condor.html"><a href="rancher-condor.html"><i class="fa fa-check"></i><b>4.5</b> Rancher Condor</a><ul>
<li class="chapter" data-level="4.5.1" data-path="rancher-condor.html"><a href="rancher-condor.html#topology"><i class="fa fa-check"></i><b>4.5.1</b> Topology</a></li>
<li class="chapter" data-level="4.5.2" data-path="rancher-condor.html"><a href="rancher-condor.html#masterworker-condor-config"><i class="fa fa-check"></i><b>4.5.2</b> Master/Worker Condor Config</a></li>
<li class="chapter" data-level="4.5.3" data-path="rancher-condor.html"><a href="rancher-condor.html#bisquesvc-submit-node-condor-config"><i class="fa fa-check"></i><b>4.5.3</b> BisqueSvc Submit Node Condor Config</a></li>
<li class="chapter" data-level="4.5.4" data-path="rancher-condor.html"><a href="rancher-condor.html#state-logs"><i class="fa fa-check"></i><b>4.5.4</b> State &amp; logs</a></li>
<li class="chapter" data-level="4.5.5" data-path="rancher-condor.html"><a href="rancher-condor.html#test-condor"><i class="fa fa-check"></i><b>4.5.5</b> Test Condor</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bisque.ece.ucsb.edu/" target="blank">UCSB BisQue Cloud Platform</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="imagej-module" class="section level2">
<h2><span class="header-section-number">1.4</span> ImageJ Module</h2>
<div id="overview" class="section level3 unnumbered">
<h3>Overview</h3>
<p>The ImageJ module allows users to execute arbitrary ImageJ macros on single images or datasets of images. Macro parameters can be changed and parameter value lists can be provided to experiment with parameter variations. The results are stored back in BisQue as Gobjects, tables, or images.</p>
<hr />
</div>
<div id="uploading-of-imagej-pipelines" class="section level3 unnumbered">
<h3>Uploading of ImageJ Pipelines</h3>
<p>Most ImageJ macros can be uploaded and used directly with minor modifications. In order to upload a macro, click “Upload”, select the macro file, and click “Upload”. If the file extension is “.ijm”, the file will automatically be recognized as a CellProfiler macro.</p>
<p>As an example, we upload the CometAssay macro developed at the Microscopy Services Laboratory of the University of North Carolina at Chapel Hill, <a href="https://www.med.unc.edu/microscopy/resources/imagej-plugins-and-macros/comet-assay">Comet Assay</a>.</p>
<p>In order to verify the macro, it can be opened by browsing the <code>imagej_pipeline</code> resources and opening the recently uploaded macro.</p>
<p>It will look like this:</p>
<div class="figure">
<img src="images/orig_pipeline.png" alt="ImageJ Pipeline" />
<p class="caption">ImageJ Pipeline</p>
</div>
<p>Each box represents one ImageJ macro step and the arrows indicate the flow through the steps. Note that some boxes have different colors. For example, the “waitForUser” and “Dialog”-related boxes are shown in red to indicate that they are incompatible with BisQue and will render the macro non-executable. Green boxes indicate regular ImageJ steps that were kept unchanged. Blue boxes are BisQue specific steps (such as “load image from BisQue” or “store table to BisQue”).</p>
<p>In order to execute the pipeline, we need to fix the red boxes and then re-upload the pipeline. In this example, the first red boxes correspond to the <code>waitForUser</code> steps of the macro:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="ex">waitForUser</span>(<span class="st">&quot;Draw an oval around the comet head; Click OK&quot;</span>);</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="ex">run</span>(<span class="st">&quot;Measure&quot;</span>);</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="ex">waitForUser</span>(<span class="st">&quot;Draw an oval around the comet tail; Click OK&quot;</span>);</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="ex">run</span>(<span class="st">&quot;Measure&quot;</span>);</a></code></pre></div>
<p>Since BisQue modules are currently not interactive, such steps are not allowed. However, since they request user-defined regions for head and tail of the comet to analyze, we can replace them with <code>BisQueLoadPolygon</code> steps:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="ex">BisQueLoadPolygon</span>(<span class="st">&quot;head&quot;</span>);</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="ex">run</span>(<span class="st">&quot;Measure&quot;</span>);</a>
<a class="sourceLine" id="cb2-3" title="3"><span class="ex">BisQueLoadPolygon</span>(<span class="st">&quot;tail&quot;</span>);</a>
<a class="sourceLine" id="cb2-4" title="4"><span class="ex">run</span>(<span class="st">&quot;Measure&quot;</span>);</a></code></pre></div>
<p>Each <code>BisQueLoadPolygon</code> step searches for a polygon Gobject in the current image and returns it as an ImageJ selection.</p>
<p>The other red boxes correspond to ImageJ “Dialog” functions:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" title="1"><span class="ex">Dialog.create</span>(<span class="st">&quot;Do Another?&quot;</span>);</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="ex">Dialog.addCheckbox</span>(<span class="st">&quot;Yes&quot;</span>, true);</a>
<a class="sourceLine" id="cb3-3" title="3"><span class="ex">Dialog.show</span>();</a></code></pre></div>
<p>Again, since BisQue is not interactive, these are not allowed. In this example, these steps check if the user wants to analyze more comets. For simplicity, we will simply remove these steps and end the analysis after one iteration.</p>
<p>This addresses all red boxes but before being able to run the macro in BisQue, we need to add two important steps: the input and output. For the input, we can just add a new step at the very beginning:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" title="1"><span class="fu">BisQueLoadImage()</span>;</a></code></pre></div>
<p>This will load the current image of the module execution into ImageJ for analysis. Note that for larger datasets of images, the macro will be executed once for each image.</p>
<p>For the output, we will store the comet analysis results as a table back into BisQue. This is achieved by adding the following line at the end of the macro:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" title="1"><span class="ex">BisQueSaveResults</span>(<span class="st">&quot;comet stats&quot;</span>);</a></code></pre></div>
<p>This step will read the ImageJ results table and store it in BisQue under the given name. It will be linked in the output section of the current MEX (module execution) document.</p>
<p>The completed macro is now as follows:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" title="1"><span class="fu">BisQueLoadImage()</span>;</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="ex">run</span>(<span class="st">&quot;Set Measurements...&quot;</span>, <span class="st">&quot;centroid center integrated redirect=None decimal=3&quot;</span>);</a>
<a class="sourceLine" id="cb6-3" title="3"><span class="ex">setFont</span>(<span class="st">&quot;SansSerif&quot;</span>, 18);</a>
<a class="sourceLine" id="cb6-4" title="4"><span class="ex">setColor</span>(255, 255, 255);</a>
<a class="sourceLine" id="cb6-5" title="5"><span class="ex">BisQueLoadPolygon</span>(<span class="st">&quot;head&quot;</span>);</a>
<a class="sourceLine" id="cb6-6" title="6"><span class="ex">run</span>(<span class="st">&quot;Measure&quot;</span>);</a>
<a class="sourceLine" id="cb6-7" title="7"><span class="ex">BisQueLoadPolygon</span>(<span class="st">&quot;tail&quot;</span>);</a>
<a class="sourceLine" id="cb6-8" title="8"><span class="ex">run</span>(<span class="st">&quot;Measure&quot;</span>);</a>
<a class="sourceLine" id="cb6-9" title="9"><span class="ex">i</span> = nResults -1<span class="kw">;</span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="ex">tailx</span> = getResult(<span class="st">&quot;XM&quot;</span>, i);</a>
<a class="sourceLine" id="cb6-11" title="11"><span class="ex">headx</span> = getResult(<span class="st">&quot;X&quot;</span>, i-1);</a>
<a class="sourceLine" id="cb6-12" title="12"><span class="ex">taily</span> = getResult(<span class="st">&quot;YM&quot;</span>, i);</a>
<a class="sourceLine" id="cb6-13" title="13"><span class="ex">heady</span> = getResult(<span class="st">&quot;Y&quot;</span>, i-1);</a>
<a class="sourceLine" id="cb6-14" title="14"><span class="ex">tailden</span> = getResult(<span class="st">&quot;RawIntDen&quot;</span>,i);</a>
<a class="sourceLine" id="cb6-15" title="15"><span class="ex">headden</span> = getResult(<span class="st">&quot;RawIntDen&quot;</span>,i-1);</a>
<a class="sourceLine" id="cb6-16" title="16"><span class="ex">CometLen</span> = sqrt( ((tailx-headx)<span class="ex">*</span> (tailx-headx)) <span class="ex">+</span> ((taily-heady)<span class="ex">*</span>(taily-heady)) );</a>
<a class="sourceLine" id="cb6-17" title="17"><span class="ex">setResult</span>(<span class="st">&quot;TailLen&quot;</span>,i,(CometLen));</a>
<a class="sourceLine" id="cb6-18" title="18"><span class="ex">setResult</span>(<span class="st">&quot;TailMoment&quot;</span>,i , (CometLen * tailden));</a>
<a class="sourceLine" id="cb6-19" title="19"><span class="ex">setResult</span>(<span class="st">&quot;%TailDNA&quot;</span>,i ,(tailden/(tailden + headden))<span class="ex">*100</span>);</a>
<a class="sourceLine" id="cb6-20" title="20"><span class="fu">updateResults()</span>;</a>
<a class="sourceLine" id="cb6-21" title="21"><span class="ex">BisQueSaveResults</span>(<span class="st">&quot;comet stats&quot;</span>);</a></code></pre></div>
<p>After uploading this macro again, all boxes are either green or blue, indicating the pipeline is now valid for execution.</p>
<hr />
</div>
<div id="running-an-imagej-macro" class="section level3 unnumbered">
<h3>Running an ImageJ Macro</h3>
<p>ImageJ macros can be run like any other BisQue module. First, select the macro to run (in this example, we select the CometAssay macro. After viewing the pipeline, click on “Analyze” and then on “ImageJ”.
The ImageJ module page opens. Click “Select an Image” to choose a single image to run the macro on (alternatively, a dataset of images can be selected to run the macro on multiple images in parallel):</p>
<div class="figure">
<img src="images/imagej_module.2.png" alt="ImageJ Pipeline" />
<p class="caption">ImageJ Pipeline</p>
</div>
<p>Note that the selected image(s) need to have at least two polygon Gobjects: one with semantic type “head” and one with semantic type “tail”.</p>
<p>Finally, click the “Run” button to start the macro execution.</p>
<p>Once the execution finishes, the outputs are shown in section 4:</p>
<div class="figure">
<img src="images/imagej_results.png" alt="ImageJ Pipeline" />
<p class="caption">ImageJ Pipeline</p>
</div>
<p>In this case, one table “comet stats” was generated. It contains the comet statistics computed in the macro. Depending on the macro, images or Gobjects can also be generated as output (see next section).</p>
<p>The generated tables can now be processed further in additional BisQue modules or shared with other users.</p>
<hr />
</div>
<div id="special-bisque-extensions-for-imagej" class="section level3 unnumbered">
<h3>Special BisQue extensions for ImageJ</h3>
<p>There are several BisQue-specific extensions to ImageJ to allow ImageJ macros to interact with the BisQue system. Each one is described in the following.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" title="1"><span class="fu">BisQueLoadImage()</span></a></code></pre></div>
<p>This function corresponds to the <code>open()</code> function of ImageJ. Instead of opening an image from a file, however, it obtains the image from the BisQue module executor. The opened image is one of the images from the module input section.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb8-1" title="1"><span class="ex">BisQueLoadPolygon</span>(<span class="st">&quot;gobject type&quot;</span>)</a></code></pre></div>
<p>This function loads a polygon Gobject from the current image into ImageJ as a selection for further processing in the macro. The “gobject type” parameter is used to select a specific Gobject with the semantic type “gobject type”.
In other words, the current image has to have a Gobject as follows:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb9-1" title="1"><span class="op">&lt;</span><span class="ex">gobject</span> type=<span class="st">&quot;gobject type&quot;</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb9-2" title="2">  <span class="op">&lt;</span><span class="ex">polygon</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb9-3" title="3">    <span class="op">&lt;</span><span class="ex">vertex</span> index=<span class="st">&quot;0&quot;</span> t=<span class="st">&quot;0.0&quot;</span> x=<span class="st">&quot;735.0&quot;</span> y=<span class="st">&quot;617.0&quot;</span> z=<span class="st">&quot;0.0&quot;</span>/<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb9-4" title="4">    <span class="ex">...</span></a>
<a class="sourceLine" id="cb9-5" title="5">    <span class="op">&lt;</span><span class="ex">vertex</span> index=<span class="st">&quot;10&quot;</span> t=<span class="st">&quot;0.0&quot;</span> x=<span class="st">&quot;727.0&quot;</span> y=<span class="st">&quot;624.0&quot;</span> z=<span class="st">&quot;0.0&quot;</span>/<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb9-6" title="6">  <span class="op">&lt;</span>/<span class="ex">polygon</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="op">&lt;</span>/<span class="ex">gobject</span><span class="op">&gt;</span></a></code></pre></div>
<p>This can be generated for example via the graphical annotations tool in the BisQue image viewer.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb10-1" title="1"><span class="ex">BisQueSaveImage</span>(<span class="st">&quot;image name&quot;</span>)</a></code></pre></div>
<p>This function corresponds to the <code>saveAs("Tiff", ...)</code> function of ImageJ. Instead of saving the image to a file, however, it stores the image back into BisQue as a new image resource. The created image is then referenced in the MEX (module execution) document’s output section.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb11-1" title="1"><span class="ex">BisQueSaveROIs</span>(<span class="st">&quot;polygon&quot;</span>, <span class="st">&quot;label&quot;</span>, <span class="st">&quot;color&quot;</span>)</a></code></pre></div>
<p>This function stores the current ImageJ ROIs as polygon Gobjects in the output section of the current MEX (module execution) document. Each polygon is assigned the provided label and color.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb12-1" title="1"><span class="ex">BisQueAddTag</span>(<span class="st">&quot;tag_name&quot;</span>, <span class="st">&quot;tag_value&quot;</span>)</a></code></pre></div>
<p>This function adds a tag/value pair to the output section of the current MEX (module execution) document.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb13-1" title="1"><span class="fu">BisQueSaveResults()</span></a></code></pre></div>
<p>This function stores the current ImageJ result table as a table resource in BisQue. The created table is then referenced in the MEX (module execution) document’s output section.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="how-to-run-a-module.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="cellprofiler-module.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["BisQue_Documentation.pdf", "BisQue_Documentation.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
